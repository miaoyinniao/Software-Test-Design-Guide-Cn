<html>
<head>
  <title>10.1 技术</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268644 (zh-CN); Windows/5.1.2600 Service Pack 2;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1995"/>
<h1>10.1 技术</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><h2 style="font-size: 31px;"><font size="3" style="font-size: 24px;"><a name="326"></a><a name="ch10lev1sec2"></a>技术</font></h2><div style="font-size: 24px;"><h3 style="font-size: 26px;"><font size="3" style="font-size: 24px;"><a name="327"></a><a name="ch10lev2sec1"></a>控制流图</font></h3><div><br></div><div>控制流图是控制流测试的基础。该图定义了模块控制结构，模块代码转换成了流图，路径通过流图来分析，测试用例通过分析流图得出，控制流图包含一些元素。</div><div>关键点 控制流图是控制流测试的基础</div><a name="IDX-146"></a><div><a name="IDX-146"><br></a></div>
处理块<br><div><h4>处理块是程序语句的从开始到终点的执行序列。只能通过开始点进入块，只能通过重点结束，一旦块初始化了，每条块中的语句将按序列执行。在控制流图中，过程块用圈和箭头表示，如下：</h4><div><img src="10.1 技术_files/Image.png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div><br></div><div>判决点</div></div><div>判决点是控制流图中的改变点，大多数判决点是二元的，通过IF语句实现。多路判决点通过Case语句实现，如下图表示：</div><div><img src="10.1 技术_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><h4>汇聚点</h4><div><h4>汇聚点是控制流图中的集合点</h4></div><div><img src="10.1 技术_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>下面是一段代码相应的控制流图：</div><div><img src="10.1 技术_files/Image [3].png" type="image/png" height="871" style="cursor: default;cursor: default;" width="1025"/></div><div>Figure 10-1: Flow graph equivalent of program code.</div></div></div><div style="font-size: 24px;"><h3 style="font-size: 26px;"><font size="3" style="font-size: 24px;">覆盖层次</font></h3><div>在控制流测试中，定义了不同层次的测试覆盖。覆盖是指有多少代码我们已经测试了相对于待测试代码。在控制流测试中我们定义了不同的覆盖层次。（注意这里不是按覆盖层次顺序介绍的）</div><div><h4>层次 1</h4><div>最低层次的覆盖是100%语句覆盖，是指每条语句都被覆盖执行至少一次。看起来这是一个合理的目标，但实际上很多缺陷还是会遗漏。考虑如下代码片段：</div><div><pre>
     if (a&gt;0) {x=x+1;}
     if (b==3) {y=0;}
</pre></div><p>控制流图如下：</p><p><a name="333"></a><img src="10.1 技术_files/Image [4].png" type="image/png" style="cursor: default;cursor: default;"/><br style="LINE-HEIGHT: 1">
Figure 10-2: Graphical representation of the two-line code snippet.</p><div>这两行代码有四条执行路径，如下：</div><p><a name="334"></a><img src="10.1 技术_files/Image [5].png" type="image/png" height="607" style="cursor: default;cursor: default;" width="984"/><br style="LINE-HEIGHT: 1">
Figure 10-3: Four execution paths.</p><div>而一个简单的测试用例就可以测试覆盖到每行代码（比如a=6 and b=3 作为输入），显然这会遗漏测试很多路径，那么，语句覆盖，不是理想测试覆盖层次。</div><div><br></div><div>虽然语句覆盖是最低层级的测试，但实际操作中这一层次的全覆盖也很难完成。一般模块中会包含处理异常环境的代码--内存不足，不可读文件，连接丢失等，测试人员会发现模拟这些环境不太可能，那么这些代码仍然没有测试到。</div><div>Holodeck 是一个模拟很多异常情况，通过Holodeck说明“它允许你-测试人员-通过观察系统调用和创建测试用例来在软件执行中改变应用行为，改变包括操作发给函数的参数和返回值，甚至可以改变错误码和事件，这些可能性能够让你的软件运行在仿真这些环境下，因此叫做Holodeck，不需要你拔网线，接坏道的磁盘，网络上的坏包，以及构建任何机器遭遇的特定环境，你用Holodeck就可以仿真，故障可以用Holodeck很容易的仿真出来。</div><blockquote><p><b>Holodeck</b></p><p>下载地址 visit <a href="http://www.sisecure.com/holodeck/holodeck-trial.aspx" target="_top">http://www.sisecure.com/holodeck/holodeck-trial.aspx</a>.</p></blockquote></div><div><h4>层次 0</h4><div>事实上，这是比100%代码覆盖还低的层级，它的定义是随便测试，剩余的让用户去测试。用这种层级测试的企业将会有灭顶之灾。关于该层次的测试覆盖，Boris Beizer写到“用这种测试覆盖方法去测试新软件是罪恶的，这种情况是不灵清的，系统中遗留没有测试覆盖到的代码是愚蠢的，短视的，不负责任的”。</div></div><div><h4>层次 2</h4><div>高一层次的控制流覆盖是100%分支覆盖，确保每个分支有<b>TRUE</b> 和<b>FALSE</b> 的输出一次，在之前例子中，可以用两个用例覆盖（a=2, b=2 and a=4, b=3）。</div><div><img src="10.1 技术_files/Image [6].png" type="image/png" style="cursor: default;"/></div><p>Figure 10-4: Two test cases that yield 100% decision coverage.</p><div>Case语句有多个出口必须覆盖这些出口，注意分支覆盖不能保证路径覆盖但可以保证语句覆盖。</div></div><div><h4>层次 3</h4><ul><li><div>不是所有的条件覆盖都像之前的例子那样简单，考虑下面的语句</div><a name="338"></a><a name="IDX-151"></a><div><pre>
     if (a&gt;0 &amp;&amp; c==1) {x=x+1;}
     if (b==3 || d&lt;0) {y=0;}
</pre></div><div><br></div><div>要为<b>TRUE,第一条语句需要a&gt;0和</b><b>c</b>=1.第二条语句需要 <b>b=</b>3 或者<b>d</b>&lt; 0.在第一条语句中如果a=0那么c=1部分将不会测试覆盖（大部分情况不会c==1）,该层次覆盖为100%条件覆盖，该层次覆盖确保每个条件<b>TRUE</b> 和<b>FALSE</b> 输出至少一次.该层次的测试用两个用例覆盖 (<b>a&gt;0, c=1, b=3, d&lt;0</b> and <b>a≤0, c≠1, b≠3, d≥0</b>). 条件覆盖比分支覆盖要好因为每个单独条件至少测试一次而分支覆盖不一定覆盖每个条件。</div></li></ul></div><div><h4>层次 4</h4><ul><li><p>考虑这种情况:</p><div><pre>
     if(x&amp;&amp;y) {conditionedStatement;}
     // 注意 &amp;&amp; 代表 AND
</pre></div><div><br></div><div>我们用两个用例完成条件覆盖(<b>x=TRUE, y=FALSE</b> and <b>x=FALSE, y=TRUE</b>) ，但是注意这种情况下conditionedStatement 将不会执行。因此该层次为100%条件/分支覆盖,覆盖所有条件和分支。</div></li></ul><a name="339"></a><a name="IDX-152"></a></div><div><h4>层次 5</h4><ul><li><div>更全面的，考虑程序如何编译来确定多条件分支，100%多条件覆盖。</div><div><pre>
     if (a&gt;0 &amp;&amp; c==1) {x=x+1;}
     if (b==3 || d&lt;0) {y=0;}
     // note: || means logical OR
</pre></div><p>分析如下:</p><p><a name="340"></a><img src="10.1 技术_files/Image [7].png" type="image/png" style="cursor: default;"/><br style="LINE-HEIGHT: 1">
该层次用4个用例覆盖</p><div><pre>
     <b>a&gt;0, c=1, b=3, d&lt;0</b>
     <b>a≤0, c=1, b=3, d≥0</b>
     <b>a&gt;0, c≠1, b≠3, d&lt;0</b>
     <b>a≤0, c≠1, b≠3, d≥0</b></pre></div><div><br></div><div>完成100%多条件覆盖也就完成了分支覆盖，条件覆盖，条件/分支覆盖。注意多条件覆盖不能保证路径覆盖。</div></li></ul></div><div><h4>层次 7</h4><ul><li><div>最好我们来讲100%路径覆盖，对于没有循环的代码模块，测试能够全面覆盖路径，对于有循环的代码模块，路径数是巨大的，测试覆盖所有路径成了很大的问题。</div><p><a name="342"></a><img src="10.1 技术_files/Image [8].png" type="image/png" style="cursor: default;"/><br style="LINE-HEIGHT: 1">
Figure 10-6: An interesting flow diagram with many, many paths.</p></li></ul></div><div><h4>层次 6</h4><ul><li><div>当模块代码中含有循环时，路径数是无限的，那么明显的但很有意义的缩减用例就非常重要了-限制循环执行次数。第一个用例执行循环0次，第二个是执行一次，第3个是执行循环N次（足够小，典型值），第四次是最大循环数M，另外最好测试一下M-1,M+1.</div><div><br></div></li></ul><div><br></div><div>在开始控制流测试之前，需要选择适当的测试覆盖层次。</div><div>结构化测试/基本路径测试</div></div><div>没有结构化测试（基本路径测试）的表示是无法完整的讨论控制流测试的。</div><div>结构化测试过程包含以下步骤：</div></div><div style="font-size: 24px;"><ul><li><p>根据软件模块代码画出控制流图</p></li><li><p>计算控制流图圈复杂度</p></li><li><p>选择C基本路径集合</p></li><li><p>根据基本路径写测试用例</p></li><li><p>执行这些用例</p></li></ul><p>考虑以下控制流图：</p><div><a name="345"></a><img src="10.1 技术_files/Image [9].png" type="image/png" style="cursor: default;"/><br style="LINE-HEIGHT: 1">
Figure 10-7: An example control flow graph.</div><p>McCabe 定义圈复杂度：</p><p>C = edges - nodes + 2</p><a name="346"></a><a name="IDX-155"></a><div><br></div><div>Edges是箭头数, nodes是圆圈数. 上图中24 箭头数和 19 圆圈数.那么圈复杂度是24-19+2 = 7.</div><div>有些情况算法更加简单，如果分支都是二位分支，那么P个分支，</div><div>C = p+1</div><div><br></div><div>圈复杂度是独立的，非循环路径的最小数据覆盖，在线性组合中，生成所有的可能路径，在流图中，每个基本路径遍历每条边至少一次。</div><p>McCabe的结构化测试技术叫做创建C个测试用例，覆盖每条基本路径。</p><table border="0" cellpadding="0" cellspacing="0" style="font-size: 24px;"><tbody><tr><td valign="top"><br></td><td valign="top" width="96">创建和执行C<br></td><td valign="top">个测试用例，基于基本路径，保证分支和语句覆盖，因为基本路径覆盖了所有边和节点，满足结构化测试保证了分支和语句覆盖。</td></tr></tbody></table><div>McCabe给出的创建基本路径测试的步骤如下：</div><div>1. 选取基本路径，这个路径是典型路而不是异常分支，最好的选择是从测试的角度看是最重要的分支</div><div><img src="10.1 技术_files/Image [10].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-8: The chosen baseline basis path ABDEGKMQS</div><div>选择下个分支，改变第一个分支的结果而保持其他分支路径。</div><div><img src="10.1 技术_files/Image [11].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-9: The second basis path ACDEGKMQS</div><div><br></div><div>第三个路径，基于基本路径改变第二个分支</div><div><img src="10.1 技术_files/Image [12].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-10: The third basis path ABDFILORS</div><div><br></div><div>第四个路径，基于基本路径改变第三个分支，其他不变。</div><div><img src="10.1 技术_files/Image [13].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-11: The fourth basis path ABDEHKMQS</div><div><img src="10.1 技术_files/Image [14].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-12: The fifth basis path ABDEGKNQS</div><div><br></div><div>现在所有分支都已经遍历，我们看第二路径，其他不变。</div><div><img src="10.1 技术_files/Image [15].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-13: The sixth basis path ACDFJLORS</div><div><img src="10.1 技术_files/Image [16].png" type="image/png" style="cursor: default;"/></div><div>Figure 10-14: The seventh basis path ACDFILPRS</div><div><br></div><div>那么，基本路径集合如下：</div><div><br></div><ul><li><p>ABDEGKMQS</p></li><li><p>ACDEGKMQS</p></li><li><p>ABDFILORS</p></li><li><p>ABDEHKMQS</p></li><li><p>ABDEGKNQS</p></li><li><p>ACDFJLORS</p></li><li><p>ACDFILPRS</p></li></ul><div><br></div><div>结构化测试技术所谓创建C个测试用例，覆盖每条基本路径，确保分支和语句覆盖。</div><div>注意，基本路径可以是多个集合，并不是唯一的集合，但是每个集合都可以覆盖到每条语句和分支。</div></div></div><div style="font-size: 24px;"><br></div><div style="font-size: 24px;"><br></div><div style="font-size: 24px;"><br></div><div style="font-size: 24px;"><br></div><div style="font-size: 24px;"><br></div><div style="font-size: 24px;"><br></div><div><br></div></div>
</div></body></html> 